<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Using JBrowse Circular Genome View</title>
    <!-- The commented scripts below are the minified production versions of the
      other scripts -->
    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin="anonymous"></script>
<!--    <script src="https://unpkg.com/@jbrowse/react-circular-genome-view/dist/react-circular-genome-view.umd.development.js"
            crossorigin="anonymous"></script>-->
    <script
            src="https://s3.amazonaws.com/jbrowse.org/jb2_releases/react-circular-genome-view/react-circular-genome-view%40v1.3.2/react-circular-genome-view.umd.development.js"
            crossorigin=""
    ></script>
<!--    <script src="https://unpkg.com/react@16/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@jbrowse/react-circular-genome-view/dist/react-circular-genome-view.umd.production.min.js"
            crossorigin></script>-->

</head>
<body>

<div id="jbrowse_circular_genome_view" style="width: 800px;height: 800px;"></div>

<script type="module">

    const { createElement } = React
    const { render } = ReactDOM
    const {
        createViewState,
        JBrowseCircularGenomeView,
    } = JBrowseReactCircularGenomeView

    const circularState = new createViewState({
        assembly: {
            name: 'forIGV',
            sequence: {
                trackId: 'refSeqTrack',
                type: 'ReferenceSequenceTrack',
                adapter: {
                    type: 'FromConfigSequenceAdapter',
                    features: [],
                },
            },
        },
        tracks: [
            {
                trackId: 'firstTrack',
                assemblyNames: ['forIGV'],
                type: 'VariantTrack',
                adapter: {
                    type: 'FromConfigAdapter',
                    features: [],
                },
            },
        ],
    })

    render(
        createElement(JBrowseCircularGenomeView, { viewState: circularState }),
        document.getElementById('jbrowse_circular_genome_view'),
    )

    const regions = [
        {
            refName: 'chr1',
            uniqueId: 'chr1',
            start: 0,
            end: 1000,
        },
        {
            refName: 'chr2',
            uniqueId: 'chr2',
            start: 0,
            end: 50,
        },
    ]
    circularState.config.assembly.sequence.adapter.features.set(regions)
    circularState.assemblyManager.removeAssembly(
        circularState.assemblyManager.assemblies[0]
    )
    circularState.assemblyManager.addAssembly(circularState.config.assembly)

    const chords = [
        {
            uniqueId: 'feature1',
            refName: 'chr1',
            start: 312,
            end: 313,
            mate: {
                refName: 'chr2',
                start: 13,
                end: 14,
            },
        },
        {
            uniqueId: 'feature2',
            refName: 'chr1',
            start: 589,
            end: 608,
            mate: {
                refName: 'chr1',
                start: 238,
                end: 239,
            },
        },
    ]

    circularState.config.tracks[0].adapter.features.set(chords)
    circularState.session.view.showTrack(circularState.config.tracks[0].trackId)

    function onChordClick(feature, chordTrack, pluginManager) {
        console.log(feature)
    }
    circularState.pluginManager.jexl.addFunction('onChordClick', onChordClick)
    circularState.config.tracks[0].displays[0].onChordClick.set(
        'jexl:onChordClick(feature, track, pluginManager)'
    )

</script>

</body>
</html>